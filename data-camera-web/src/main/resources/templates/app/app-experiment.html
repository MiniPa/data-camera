<html lang="en" xmlns:th="http://www.thymeleaf.org">

<body>
    <div th:fragment="app-experiment">
        <!-- 实验操作按钮 -->
        <div class="app-exp-action-bar">
            <div class="btn-group">
                <button class="btn btn-default" data-toggle="modal" data-target="#exp-modal" todo="new">
                    <i class="fa fa-plus-circle"></i>&nbsp;添加传感器组</button>
                <a class="btn btn-default" th:href="@{/device}"><i class="fa fa-plus-circle"></i>&nbsp;添加新设备</a>
            </div>
            <div class="btn-group">
                <button class="btn btn-default" onclick="allMonitor()" id="all-monitor-btn">
                    <i class="fa fa-eye"></i>&nbsp;全局监控</button>
                <button class="btn btn-default" onclick="allRecord()" id="all-record-btn">
                    <i class="fa fa-camera-retro"></i>&nbsp;全局录制</button>
            </div>
        </div>

        <div class="app-exp-container">
            <!-- 场景下没有实验 -->
            <div th:if="${#maps.isEmpty(experiments)}"
                 class="alert alert-info my-alert" role="alert">TIPS: 场景中还没有传感器组，请点击上方“添加传感器组”按钮可进行相关操作:)</div>

            <!-- 遍历构造实验panel -->
            <th:block th:each="experiment,expIndex:${experiments}">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <!-- 标题 -->
                            <a role="button" data-toggle="collapse" th:href="@{|#exp-${experiment.key}|}" aria-expanded="true">
                                <i class="fa fa-arrows-v"></i>&nbsp;
                            </a>
                            <a th:text="|传感器组：${experiment.value.name} - |" th:data="${experiment.key}" data-toggle="modal" data-target="#exp-modal" todo="edit" from="modify-desc"></a>
                            <!-- 状态栏 -->
                            <small th:text="${experiment.value.description}" style="color: #9d9d9d"></small>
                            <span class="pull-right">
                                <span class="label label-default" th:id="|experiment-es-${experiment.key}|">非监控</span>
                                <span class="label label-default" th:id="|experiment-rs-${experiment.key}|">非录制</span>
                            </span>
                        </div>
                    </div>
                    <div th:id="|exp-${experiment.key}|" class="panel-collapse collapse in" role="tabpanel">
                        <div class="panel-body my-panel-body">
                            <!-- 实验状态和操作栏 -->
                            <div class="app-exp-status">
                                <!-- 按钮组 -->
                                <span class="btn-group">
                                    <button class="btn btn-default btn-sm" th:data="${experiment.key}"
                                            data-toggle="modal" data-target="#exp-modal" todo="edit" from="modify-sensor"><i class="fa fa-plus"></i></button>
                                    <button class="btn btn-default btn-sm" th:data="${experiment.key}" onclick="deleteExp(this)"><i class="fa fa-trash"></i></button>
                                    <button th:if="${not #lists.isEmpty(experiment.value.trackInfoList)}" class="btn btn-default btn-sm" th:data="${experiment.key}" onclick="expMonitor(this)" th:id="|experiment-monitor-${experiment.key}|">
                                    <i class="fa fa-eye"></i></button>
                                    <button th:if="${not #lists.isEmpty(experiment.value.trackInfoList)}" class="btn btn-default btn-sm" th:data="${experiment.key}" onclick="expRecorder(this)" th:id="|experiment-recorder-${experiment.key}|">
                                    <i class="fa fa-camera-retro"></i></button>
                                </span>
                            </div>

                            <!-- 实验图表和数据 -->
                            <div class="app-exp-content">
                                <div th:if="${#lists.isEmpty(experiment.value.trackInfoList)}"
                                     class="alert alert-info my-alert" role="alert">
                                    TIPS: 传感器组中暂无任何传感器，点击上方“+”按钮可添加传感器:)</div>

                                <th:block th:each="track,trackIndex:${experiment.value.trackInfoList}">
                                    <div class="track">
                                        <!-- 轨迹信息 -->
                                        <div class="track-info" th:switch="${track.type}">
                                            <div class="title">
                                                <span th:case="0" th:text="|未绑定传感器的轨迹|"></span>
                                                <span th:case="1" th:text="|可绑定数值型传感器的轨迹|"></span>
                                                <span th:case="2" th:text="|可绑定摄像头的轨迹|"></span>
                                                <span class="track-bound">绑定的传感器：
                                                    <a href="#" th:id="|track-bound-${track.id}|" data-type="select" data-title="绑定设备"></a>
                                                </span>
                                                <button class="btn btn-default btn-xs pull-right" th:data="${track.id}" onclick="deleteTrack(this)"><i class="fa fa-close"></i></button>
                                            </div>
                                        </div>

                                        <!-- 图表及统计信息, 遍历传感器维度 -->
                                        <div th:if="${track.sensor == null}" style="height: 50px"></div>
                                        <div class="track-content" th:if="${track.sensor != null}">
                                            <th:block th:each="dim,dimIndex:${#strings.listSplit(track.sensor.sensorConfig.dimension,';')}">
                                                <div class="panel panel-default my-panel">
                                                    <div class="panel-heading my-panel-heading">
                                                        <div class="panel-title">
                                                            <a role="button" data-toggle="collapse" th:href="@{|#exp-${experiment.key}-${track.id}-${dim}|}" aria-expanded="true">
                                                                <i class="fa fa-arrows-v"></i>&nbsp; <span th:text="|${dim}(${#strings.listSplit(track.sensor.sensorConfig.unit,';').get(dimIndex.count - 1)})|"></span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div th:id="|exp-${experiment.key}-${track.id}-${dim}|" class="panel-collapse collapse in" role="tabpanel">
                                                        <div class="panel-body my-panel-body">
                                                            <div class="row">
                                                                <!-- 轨迹绑定的传感器内容，包括：未绑定，数值型，摄像头 -->
                                                                <div class="col-xs-9 col-sm-9 col-md-9" th:switch="${track.type}">
                                                                    <div th:id="|experiment-track-${experiment.key}-${track.id}-${dim}|" class="track-chart">
                                                                        <div th:case="1">
                                                                            <strong>轨迹加载中</strong>
                                                                        </div>
                                                                        <div th:case="2">
                                                                            <div class="text-center">
                                                                                <h1 style="color: #ac2925" class="shake-slow shake-constant">REC</h1>
                                                                            </div>
                                                                        </div>
                                                                        <div th:case="0">
                                                                            <div class="alert alert-warning my-alter" role="alert">TIPS: 当前轨迹暂未绑定任何传感器，将不会产生数据</div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- 轨迹绑定的传感器内容的统计信息 -->
                                                                <div class="col-xs-3 col-sm-3 col-md-3" style="padding-top: 10px;">
                                                                    <div class="track-statistics" th:switch="${track.type}">
                                                                        <div class="content-sub-text" th:switch="${track.type}">
                                                                            <div th:case="1">
                                                                                <div class="text-left">
                                                                                    最大值：<span th:class="|content-value-${experiment.key}|" style="margin-right: 10px" th:id="|experiment-info-${experiment.key}-${track.id}-${dim}-1|">-</span>
                                                                                    最小值：<span th:class="|content-value-${experiment.key}|" th:id="|experiment-info-${experiment.key}-${track.id}-${dim}-2|">-</span>
                                                                                </div>
                                                                            </div>
                                                                            <div th:case="2">
                                                                                开始录制时间: <span th:class="|content-value-${experiment.key}|" th:id="|experiment-info-${experiment.key}-${track.id}-${dim}|">-</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="content-now-text" th:switch="${track.type}">
                                                                            <div class="text-left">
                                                                                <span th:class="|content-value-${experiment.key}|" th:id="|experiment-now-${experiment.key}-${track.id}-${dim}|">-</span>
                                                                                <span th:text="${#strings.listSplit(track.sensor.sensorConfig.unit,';').get(dimIndex.count - 1)}"></span>
                                                                                <span th:case="1" class="content-sub-text">当前值</span>
                                                                                <span th:case="2" class="content-sub-text">持续时间</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </th:block>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
        </div>

        <div th:include="module/common::sub-footer"></div>
    </div>
</body>

</html>