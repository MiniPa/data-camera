<html lang="en" xmlns:th="http://www.thymeleaf.org">

<body>
    <div th:fragment="app-experiment">
        <div class="row">
            <!-- 实验操作按钮 -->
            <div class="col-xs-12 col-sm-12 col-md-12">
                <div class="app-exp-button-group">
                    <button class="btn btn-success" data-toggle="modal" data-target="#exp-modal" todo="new">
                        <i class="fa fa-plus-circle"></i>&nbsp;添加新实验</button>
                    <a class="btn btn-default" th:href="@{/device}"><i class="fa fa-plus-circle"></i>&nbsp;添加新设备</a>
                    <button class="btn btn-default" type="button"
                            data-toggle="collapse" data-target="#exp-help" aria-expanded="false" aria-controls="exp-help">
                        <i class="fa fa-question-circle"></i>&nbsp;获取帮助
                    </button>

                    <span class="pull-right">
                        <button class="btn btn-warning" onclick="allMonitor()">
                        <i class="fa fa-eye"></i>&nbsp;全局监控</button>
                    <button class="btn btn-danger" onclick="allMonitor()">
                        <i class="fa fa-camera-retro"></i>&nbsp;全局录制</button>
                    </span>
                </div>
                <div class="collapse" id="exp-help">
                    <!-- 页面说明 -->
                    <div class="app-page-introduction">
                        <p>
                            <i class="fa fa-info-circle"></i>&nbsp;在实验模式中，你能够随时监控传感器的数据，并且根据你的需要录制数据，录制的数据会被保存，你可以在“数据分析模式”下分析这些数据
                        </p>
                        <p>
                            <i class="fa fa-info-circle"></i>&nbsp;点击“监控”按钮，让数据动起来，此时传感器数据会被保存到数据库中；点击“录制”按钮，录制并保存你想要的实验数据
                        </p>
                        <p>
                            <i class="fa fa-info-circle"></i>&nbsp;在数据分析模式中，你能够分析之前所录制的实验数据
                        </p>
                        <p>
                            <i class="fa fa-info-circle"></i>&nbsp;你可以任意编辑你所记录的数据，并以回放的方式来重现数据
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-sm-12">
                <div id="app-experiment-loading"></div>
                <div th:if="${#maps.isEmpty(experiments)}"
                     class="alert alert-info" role="alert">TIPS: 应用下还没有实验，点击上方“添加新实验”按钮可新建实验:)</div>
                <!-- 遍历构造实验tab -->
                <th:block th:each="experiment,index:${experiments}">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="panel-title">
                                <strong th:text="|实验：${experiment.value.name}|">
                                </strong>
                            </div>
                        </div>
                        <div class="panel-body">
                            <!-- 实验状态和操作栏 -->
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="app-exp-status-container">
                                        <span>实验状态</span>
                                        <span class="label label-default" th:id="|experiment-es-${experiment.key}|">非监控</span>
                                        <span class="label label-default" th:id="|experiment-rs-${experiment.key}|">非录制</span>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="app-exp-status-container">
                                        <span>实验操作</span>
                                        <span>
                                            <button class="btn btn-default btn-sm" th:data="${experiment.key}"
                                                    data-toggle="modal" data-target="#exp-modal" todo="edit"
                                                    style="margin-right: 10px"><i class="fa fa-info-circle"></i>&nbsp;编辑实验</button>
                                            <button class="btn btn-default btn-sm" th:data="${experiment.key}" onclick="deleteExp(this)"><i class="fa fa-minus-circle"></i>&nbsp;删除实验</button>
                                        </span>
                                        <span th:if="${not #lists.isEmpty(experiment.value.trackInfoList)}" class="app-exp-button pull-right">
                                            <button class="btn btn-warning" th:data="${experiment.key}" onclick="expMonitor(this)" th:id="|experiment-monitor-${experiment.key}|">
                                                <i class="fa fa-eye"></i>&nbsp;开始监控</button>
                                            <button class="btn btn-danger" th:data="${experiment.key}" onclick="expRecorder(this)" th:id="|experiment-recorder-${experiment.key}|">
                                                <i class="fa fa-camera-retro"></i>&nbsp;开始录制</button>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- 实验内容 -->
                            <div th:if="${#lists.isEmpty(experiment.value.trackInfoList)}"
                                 class="alert alert-info" role="alert" style="margin-top: 10px;margin-bottom: 20px">
                                TIPS: 实验下暂无相关设备，点击上方“编辑实验”按钮可添加设备:)</div>
                            <th:block th:each="track,index:${experiment.value.trackInfoList}">
                                <div class="app-exp-track-container">
                                    <div class="row">
                                        <div class="col-xs-9 col-sm-9 col-md-9" th:switch="${track.type}">
                                            <div th:id="|experiment-track-${experiment.key}-${track.id}|" class="app-exp-track-chart">
                                                <div th:case="1">
                                                    <strong>轨迹加载中</strong>
                                                </div>
                                                <div th:case="2">
                                                    <div class="alert alert-info" role="alert" style="font-weight: 600; font-size: 16px">
                                                        TIPS: 视频轨迹在实验状态下无法看到实时数据状态，录制结束后可在“分析模式”中看到</div>
                                                    <div class="text-center">
                                                        <h1 style="color: #ac2925" class="shake-slow shake-constant">REC</h1>
                                                    </div>
                                                </div>
                                                <div th:case="0">
                                                    <div class="alert alert-warning" role="alert" style="font-weight: 600; font-size: 16px">
                                                        TIPS: 当前轨迹暂未绑定任何传感器，将不会产生数据</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-3 col-sm-3 col-md-3">
                                            <div class="app-exp-track-statistics" th:switch="${track.type}">
                                                <div class="title">
                                                    <span th:case="0" th:text="|未绑定设备的轨迹|"></span>
                                                    <span th:case="1" th:text="|数值型轨迹${track.id}-统计信息|"></span>
                                                    <span th:case="2" th:text="|视频轨迹${track.id}-统计信息|"></span>
                                                    <button class="btn btn-default btn-xs pull-right" th:data="${track.id}" onclick="deleteTrack(this)"><i class="fa fa-close"></i></button>
                                                </div>
                                                <div class="content">
                                                    <div th:if="${track.sensor != null}" class="content-text">
                                                        <th:block th:each="myunit,index:${#strings.listSplit(track.sensor.sensorConfig.unit,';')}">
                                                            <div class="content-sub-text" th:switch="${track.type}">
                                                                <div th:case="1">
                                                                    <div class="text-left">
                                                                        最大值：<span class="content-value" style="margin-right: 10px" th:id="|experiment-info-${experiment.key}-${track.id}-${index.count}-1|">-</span>
                                                                        最小值：<span class="content-value" th:id="|experiment-info-${experiment.key}-${track.id}-${index.count}-2|">-</span>
                                                                    </div>
                                                                </div>
                                                                <div th:case="2">
                                                                    开始录制时间: <span class="content-value" th:id="|experiment-info-${experiment.key}-${track.id}-${index.count}|">-</span>
                                                                </div>
                                                            </div>
                                                            <div class="content-now-text" th:switch="${track.type}">
                                                                <div class="text-left">
                                                                    <span class="content-value" th:id="|experiment-now-${experiment.key}-${track.id}-${index.count}|">-</span>
                                                                    <span th:text="${myunit}"></span>
                                                                    <span th:case="1" class="content-sub-text">当前值</span>
                                                                    <span th:case="2" class="content-sub-text">持续时间</span>
                                                                </div>
                                                            </div>
                                                        </th:block>
                                                    </div>
                                                    <div class="content-bound-sensor">绑定的设备：
                                                        <a href="#" th:id="|track-bound-${track.id}|" data-type="select" data-title="绑定设备"></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </th:block>
                        </div>
                    </div>
                </th:block>
            </div>
        </div>

        <div th:include="module/common::sub-footer"></div>
    </div>
</body>

</html>